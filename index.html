<!-- Sama seperti sebelumnya, tapi: -->
<script>
  let verified = false;

  async function kirimKode() {
    const nomor = document.getElementById('nomor').value.trim();
    const status = document.getElementById('status');

    if (!/^62[0-9]{9,15}$/.test(nomor)) {
      status.innerText = "❌ Nomor tidak valid.";
      return;
    }

    status.innerText = "⏳ Mengirim kode OTP...";

    const res = await fetch('/api/send-otp', {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ nomor })
    });

    const json = await res.json();
    if (json.ok) {
      status.innerText = "✅ Kode OTP telah dikirim via WhatsApp.";
    } else {
      status.innerText = `❌ Gagal kirim OTP: ${json.error}`;
    }
  }

  async function verifikasiKode() {
    const kode = document.getElementById('kode').value.trim();
    const nomor = document.getElementById('nomor').value.trim();
    const status = document.getElementById('status');

    if (!kode) return status.innerText = "❌ Masukkan kode OTP";

    // Kirim ke backend untuk diverifikasi
    const res = await fetch('/api/verif-otp', {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ nomor, kode })
    });

    const json = await res.json();
    if (json.ok) {
      verified = true;
      document.getElementById('pesan').disabled = false;
      document.getElementById('btn-kirim').disabled = false;
      document.getElementById('verif-status').style.display = "block";
      status.innerText = "✅ Verifikasi berhasil.";
    } else {
      status.innerText = "❌ Kode salah atau kadaluarsa.";
    }
  }
</script>
