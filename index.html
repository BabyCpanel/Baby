// Struktur Project: wa-otp-sender (Vercel Ready)

// ==================== vercel.json ==================== { "version": 2, "builds": [{ "src": "api/.js", "use": "@vercel/node" }], "routes": [ { "src": "/api/(.)", "dest": "/api/$1.js" }, { "src": "/", "dest": "/public/index.html" } ] }

// ==================== package.json ==================== { "name": "wa-otp-sender", "version": "1.0.0", "dependencies": { "@whiskeysockets/baileys": "^6.6.0", "pino": "^8.0.0" } }

// ==================== public/index.html ====================

<!DOCTYPE html><html>
<head>
  <title>WA OTP Sender</title>
  <meta charset="UTF-8" />
</head>
<body>
  <h2>Login via OTP</h2>
  <input id="phone" placeholder="Nomor WA (62xxxx)"><br>
  <button onclick="requestOTP()">Minta OTP</button>  <div id="otpBox" style="display:none">
    <input id="otp" placeholder="Kode OTP">
    <button onclick="verifyOTP()">Verifikasi</button>
  </div>  <div id="sendBox" style="display:none">
    <textarea id="targets" placeholder="1 nomor per baris"></textarea><br>
    <textarea id="message" placeholder="Pesan kamu..."></textarea><br>
    <button onclick="sendMessage()">Kirim Pesan</button>
  </div><script>
  let sender = "";
  async function requestOTP() {
    const phone = document.getElementById('phone').value;
    const res = await fetch('/api/request-otp', {
      method: 'POST', headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ phone })
    });
    const data = await res.json();
    if (data.success) {
      sender = phone;
      alert('OTP dikirim!');
      document.getElementById('otpBox').style.display = 'block';
    }
  }

  async function verifyOTP() {
    const code = document.getElementById('otp').value;
    const res = await fetch('/api/verify-otp', {
      method: 'POST', headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ phone: sender, code })
    });
    const data = await res.json();
    if (data.success) {
      alert('Verifikasi sukses!');
      document.getElementById('sendBox').style.display = 'block';
    } else alert('Kode salah!');
  }

  async function sendMessage() {
    const targets = document.getElementById('targets').value.split('\n');
    const message = document.getElementById('message').value;
    const res = await fetch('/api/send', {
      method: 'POST', headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ phone: sender, targets, message })
    });
    const data = await res.json();
    alert(data.message);
  }
</script></body>
</html>// ==================== lib/otp.js ==================== const store = new Map(); export function setOTP(phone, code) { store.set(phone, { code, expires: Date.now() + 5 * 60000 }); } export function verifyOTP(phone, code) { const entry = store.get(phone); return entry && entry.code === code && Date.now() < entry.expires; }

// ==================== lib/wa.js ==================== import makeWASocket from '@whiskeysockets/baileys'; import { useSingleFileAuthState } from '@whiskeysockets/baileys'; import P from 'pino';

const { state, saveState } = useSingleFileAuthState('./auth.json'); const sock = makeWASocket({ auth: state, logger: P({ level: 'silent' }) }); sock.ev.on('creds.update', saveState);

export async function sendOTP(phone, code) { const jid = phone + '@s.whatsapp.net'; await sock.sendMessage(jid, { text: Kode OTP WA-SENDER kamu: ${code} }); } export async function sendPesan(from, targets, message) { for (const t of targets) { const jid = t + '@s.whatsapp.net'; await sock.sendMessage(jid, { text: message }); } }

// ==================== api/request-otp.js ==================== import { setOTP } from '../lib/otp.js'; import { sendOTP } from '../lib/wa.js';

export default async (req, res) => { const { phone } = await req.json(); const code = Math.floor(1000 + Math.random() * 9000).toString(); setOTP(phone, code); await sendOTP(phone, code); res.json({ success: true }); };

// ==================== api/verify-otp.js ==================== import { verifyOTP } from '../lib/otp.js';

export default async (req, res) => { const { phone, code } = await req.json(); const valid = verifyOTP(phone, code); res.json({ success: valid }); };

// ==================== api/send.js ==================== import { verifyOTP } from '../lib/otp.js'; import { sendPesan } from '../lib/wa.js';

export default async (req, res) => { const { phone, targets, message } = await req.json(); if (!verifyOTP(phone, null)) return res.status(403).json({ message: 'Belum verifikasi!' }); await sendPesan(phone, targets, message); res.json({ message: 'Pesan dikirim!' }); };

